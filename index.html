<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Moojestic</title>
    <link rel="stylesheet" href="/css/index.css">
    <!-- <link rel="stylesheet" href="http://localhost:9000/css/refresh.css"> -->
    <link rel="stylesheet" href="/css/refresh.css">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!--
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital,wght@0,400;0,500;0,600;1,500&display=swap" rel="stylesheet">-->
<link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@600&family=Lato&display=swap" rel="stylesheet">

<script type="text/javascript" src="/js/render.js"></script>
<script type="text/javascript" src="/js/loader.js"></script>

<link rel="icon" type="image/png" href="/img/cow_icon_32.png"/>
</head>
<body class="bg-dark">
<div class="container bg-dark">
    <div class="title-bar flex"><img src="/img/cow_icon.png"/>
        <div class="flow" >
            <h1>Moojestic </h1>
            <p id="date"> </p>
            <p id="error"></p>
        </div>
    </div>
    <div class="margin-in">
        <div id="puzzle" class="grid"></div>
    </div>

    <div id="answer-area" class="hidden">
        <div class="flex margin-top">
            <input type="text" autocomplete="off" placeholder="Check Answer" id="answer-input" oninput="onAnswerTextChanged(this);"/>
            <button id="clear-button" class="large-button text-light bg-dark-button" onclick="clearAnswer();"> Clear </button>
        </div>
        <div>
            <p id="feedback"></p>
        </div>
    </div>
</div>


<script type="text/javascript">
var loadedPuzzle = {};    
var correctAnswer = "";    
var answerField = document.getElementById("answer-input");
var clearButton = document.getElementById("clear-button");
var feedback = document.getElementById("feedback");

function onAnswerTextChanged(field) {
    if (field.value.length > correctAnswer.length) {
        field.value = field.value.substring(0, correctAnswer.length);
    }
    if (field.value.length == correctAnswer.length) {
        if (field.value.toLowerCase() == correctAnswer) {
            field.className = "solved";
            field.setAttribute("disabled", "disabled");
            clearButton.className = "hidden";
            feedback.innerText = "You got it!";
        } 
        else {
            showErrorFeedback(field.value.toLowerCase(), loadedPuzzle);
        }
    }
    else {
        clearErrorFeedback();
    }
}

function clearAnswer() {
    answerField.value = "";
    feedback.innerText = "";
}

function setErrorMsg(msg) {
    document.getElementById("error").innerText = msg;
}

function onLoadFail(n) {
  setErrorMsg("Failed to load Puzzle #" + n); 
}    

var todaysPuzzle = todaysPuzzleIndex();
if (window.location.search.startsWith("?puzzle=")) {
    var requestedPuzzle = window.location.search.substring(8);
    if (requestedPuzzle <= todaysPuzzle) {
        loadPuzzleNumber(requestedPuzzle, onLoadFail);
    }
    else {
        setErrorMsg("Puzzle #" + requestedPuzzle + " is not ready yet. Come back later!");
    }
}
else {
    loadPuzzleNumber(todaysPuzzle, onLoadFail);
}

</script>

<!--------- Dev Refresh Script  ------------->
<p id="refresh" class="hidden"/>
<script type="text/javascript" src="/js/dev_refresh.js"></script>
</body>

</htmnl> 